# Local Development

An important use case for virtual machines is keeping parity between development and production environments. Developing and testing in an environment identical to the production environment helps reduce the, "but it works on my machine" type of problems that happen all too frequently when releasing software.

So far the tools we have looked at for building and running images are great for automation and managing complicated infrastructure. However, for developers that want to be able to easily create, use and share environments they are not very convenient. If only we could create and start a virtual machine with just two commands...

![](img2/developer_light.svg ':size=150x150 :class=light-mode-icon')
![](img2/developer_dark.svg ':size=150x150 :class=dark-mode-icon')

?> Once again if you have an M1 Macbook, default vagrant will not work. As Vagrant by default uses virtualbox as its provider & virtualbox does not yet work on M1 macs (as of 23/02/2023) this presents a problem.

#### M1 Alternative Exercise: Vagrat for docker

1. [Install Vagrant](https://www.vagrantup.com/intro/getting-started/install).

2. Inspect the example code ch2/vagrant_docker_example

3. Read the following [vagrant provider](https://developer.hashicorp.com/vagrant/docs/provisioning/docker) [vagrant ssh](https://developer.hashicorp.com/vagrant/docs/vagrantfile/ssh_settings)

4. Discuss what the code inside the Vagrantfile is doing and how vagrant providers might be benificial


#### Exercise 1: VMs the easy way

1. [Install Vagrant](https://www.vagrantup.com/intro/getting-started/install).

2. Create a new directory and inside of it run `vagrant init centos/7`

3. Run `vagrant up`

    **Congratulations!!!** You have a new VM up and running!

4. Run `vagrant ssh` to access the new VM.

5. Exit out of the VM and run `vagrant destroy` to clean up.

## Vagrant

> Vagrant is a tool for building and managing virtual machine environments in a single workflow.
>
> _- [Introduction to Vagrant](https://www.vagrantup.com/intro/index)_

Being able to create a CentOS 7 VM in two commands is pretty cool, but what if you want to customize your VM and share it with others. Imagine you're working with a team of developers and you want the entire team to be able to use a VM with the same libraries and tools installed.

#### Exercise 2: Creating a Base Box

In this exercise, we will create a Vagrant Base Box using our VirtualBox Golden Image. Vagrant uses VirtualBox (or other providers) to run images. In order for Vagrant to be able to do this the image needs to be configured for Vagrant.

Read [Creating a Base Box](https://www.vagrantup.com/docs/boxes/base) and [Creating a (VirtualBox) Base Box](https://www.vagrantup.com/docs/providers/virtualbox/boxes.html).

1. Clone your VirtualBox Golden Image and update it to meet the requirements for a Vagrant VirtualBox Base Box.

2. Run `vagrant package ...` to create your base box.

3. Upload your base box to [VagrantUp](https://app.vagrantup.com/).

## Packer & Vagrant

You may have noticed some similarities between Packer and Vagrant. They both make use of a variety of virtualization platforms. They both have provisioners to configure machine images. This might be surprising considering both tools are made by HashiCorp. To understand the differences between these tools it can be helpful to consider the problem they are trying to solve. Packer is primarily used to create machine images, often from scratch. Vagrant's use cases focus more on making machine images easier to use and manage. Another way to understand the relationship between these tools is knowing that many of the official Vagrant Base Boxes are actually created using Packer.

#### Exercise 3: Creating a Base Box using Packer

In this exercise, you will use the Vagrant Post-Processor to build a Vagrant Box using the Packer template you created in the previous section.

1. Modify your [kickstart file](https://docs.centos.org/en-US/centos/install-guide/Kickstart2/) to automate the installation of CentOS and meet Vagrant's requirements.

    - allow the `vagrant` user to have password-less sudo
    - `UseDNS no` (optional)
    - update the CentOS packages and kernel

2. Use Packer provisioners to finish setting up the system.

    - install Vagrant [insecure key pair](https://github.com/hashicorp/vagrant/tree/master/keys) for `vagrant` user
    - install dependencies needed for VirtualBox Guest Additions
    - install Guest Additions

3. Add a [Vagrant post-processor](https://www.packer.io/docs/post-processors/vagrant/vagrant) to your Packer build template. Configure it to output both a VirtualBox image and a Vagrant box.


# Deliverable

Also, discuss the following topics.
 - What could Vagrant be used for?
 - What are base boxes for?
 - What was the hardest part of this exercise?
