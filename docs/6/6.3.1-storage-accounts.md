# Azure Storage Accounts and CDN

In this section we will demonstrate how Azure Storage Accounts can be used to host a basic website, very similar to what you did in chapter 7 with S3 & CloudFront.

## Create an Angular site hosted on Azure Blob Storage

> An [Azure Storage Account](https://docs.microsoft.com/en-us/azure/storage/common/storage-account-overview) contains all of your Azure Storage data objects: blobs, files, queues, tables, and disks. The storage account provides a unique namespace for your Azure Storage data that is accessible from anywhere in the world over HTTP or HTTPS. Data in your Azure storage account is durable and highly available, secure, and massively scalable.

For this exercise we will host a basic website on Azure Blob Storage built using [Angular](https://angular.io/).

**Requirements**
- You will need to have npm installed to perform this exercise.

1. Install the Angular CLI.

```
npm install -g @angular/cli
```

2. Create a new Angular project.

```
ng new brent-web-app
```

**(note: you can just accept the defaults when creating the new project)**

3. Run the Angular application locally. A new browser session should be launched and you will see your Angular application with all the defaults. Feel free to explore Angular and make some changes to your default project before moving on to the build step.

```
cd brent-web-app
ng serve --open
```

4. Build the Angular application. If the build is successful, your deployment files will be contained with the "dist" sub-directory in your Angular project.

```
ng build
```

5. Log into Azure CLI and select the correct subscription

```
az login
az acccount set --subscription "liatrio-sandbox"
```

6. Create the resource group.

```
RESOURCE_GROUP=RG-brent-bootcamp
LOCATION=westus
STORAGE_ACCOUNT=brentbasicwebsite123
az group create --name $RESOURCE_GROUP --location $LOCATION
az storage account create --name $STORAGE_ACCOUNT --resource-group $RESOURCE_GROUP --location $LOCATION
```

7. Create the storage account. **(note: storage account names must be globally unique and contain only lowercase and numbers)**

```
STORAGE_ACCOUNT=brentbasicwebsite123
az storage account create \
  --name $STORAGE_ACCOUNT \
  --resource-group $RESOURCE_GROUP \
  --location $LOCATION
```


8. Use [Azure Portal](https://portal.azure.com) to validate creation.

9. Enable static website hosting on the storage account

```
az storage blob service-properties update \
  --account-name $STORAGE_ACCOUNT  \
  --static-website \
  --404-document 404.html \
  --index-document index.html
```

10. Deploy the website

```
az storage blob upload-batch \
  --account-name $STORAGE_ACCOUNT  \
  -s ./dist/brent-web-app -d '$web'
```

11. Validate website. **(note: the URL will be accountname.regioncode.web.core.windows.net)**


## Enable Azure CDN for website

> [Azure Content Delivery Network](https://docs.microsoft.com/en-us/azure/cdn/cdn-overview) offers developers a global solution for rapidly delivering high-bandwidth content to users by caching their content at strategically placed physical nodes across the world. Azure CDN can also accelerate dynamic content, which cannot be cached, by leveraging various network optimizations using CDN POPs. For example, route optimization to bypass Border Gateway Protocol (BGP).

12. Create Azure CDN profile for website

```
CDN_PROFILE=brentbasiccdnprofile123
az cdn profile create -n $CDN_PROFILE \
  --sku Standard_Microsoft \
  --resource-group $RESOURCE_GROUP
```

13. Create Azure CDN endpoint for website

```
CDN_ENDPOINT=brentbasiccdnendpoint123
az cdn endpoint create -n $CDN_ENDPOINT \
  --resource-group $RESOURCE_GROUP \
  --profile-name $CDN_PROFILE \
  --origin "${STORAGE_ACCOUNT}.z22.web.core.windows.net" \
  --origin-host-header "${STORAGE_ACCOUNT}.z22.web.core.windows.net" \
  --enable-compression
```

14. Make sure you can reach the site using the Azure CDN endpoint (note: It make take some time for the endppoint to become live)

15. Cleanup the resources you created by delete the resource group.

```
az group delete -n $RESOURCE_GROUP
```