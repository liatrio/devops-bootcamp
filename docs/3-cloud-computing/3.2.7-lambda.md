# AWS Lambdas

- AWS Lambda is a serverless computing service provided by Amazon Web Services (AWS). Users of AWS Lambda create functions, self-contained applications written in one of the supported languages and runtimes, and upload them to AWS Lambda, which executes those functions in an efficient and flexible manner.

- The Lambda functions can perform any kind of computing task, from serving web pages and processing streams of data to calling APIs and integrating with other AWS services.

- The concept of “serverless” computing refers to not needing to maintain your own servers to run these functions. AWS Lambda is a fully managed service that takes care of all the infrastructure for you. And so “serverless” doesn’t mean that there are no servers involved: it just means that the servers, the operating systems, the network layer and the rest of the infrastructure have already been taken care of, so that you can focus on writing application code.

# Excercise - Creating a Lambda function with a trigger

1. Set up an s3 bucket.

2. Set up a DynamoDb table

3. Create a Python Lambda function
    - Make sure to have the right permissions
    - Add a trigger of type s3 bucket
        - Specify an event type
        - Think of what kind of files you will be uploading to the bucket

    - Make a lambda function that grabs every item from a csv file

    Here is some helpful documentation for [boto3](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/dynamodb.html)

``` python

import json
import boto3
import csv

      # lambda function handler here

   record_list = []
   
   try:
      # boto3 resources for s3 here

      # boto3 resource for dynamodb here
       
      table = dynamodb.Table('** DYNAMO-DB-TABLE-NAME ***')
      bucket = event['Records'][0]['s3']['bucket']['name']
      key = event['Records'][0]['s3']['object']['key']
      s3_object = s3_resource.Object(bucket,key)
      
      data = s3_object.get()['Body'].read().decode("utf-8").splitlines()
      lines=csv.reader(data)
      headers=next(lines)
      
      for user_data in lines:
         print(user_data)

         table.put_item(Item = {
               "id" : user_data[0],
               "Living Space (sq ft)" : user_data[1],
               "Beds" : user_data[2],
               "Baths" : user_data[3],
               "Year" : user_data[5],
               "List Price ($)" : user_data[6]
         })
      
   except Exception as e:
      print(str(e))
            
   return {
      'statusCode': 200,
      'body': json.dumps('CSV success')
   }

```

4. Once your python code is ready, download this csv file [zillow.csv](img3/zillow.csv)

5. Upload the csv file to the bucket you created at the begining of the excersise.

6. After uploading the file, the lambda funtion should run. if youre having issues make sure to check the logs, and go over youre code.

# Excercise - Creating a Lambda function for spinning up ec2 instances

1. Create a Lambda function and verify it was created in the aws console.
2. Create a Dynamodb database and similarly varify  it.
3. Create an EC2 instance and tag it with Key: "test-<your_name>-lambda" Value: "True"  or something else that distinguishes your instance from any others.
4. In your Lambda function, create a EC2 client, a Dynamodb resource, and a table with that Dynamodb resource.

``` python
import json
import boto3
import csv

def lambda_handler(event, context):
   
   try: 
      region = 'us-east-1'
      ec2 = boto3.client('ec2', region_name=region)
      dynamodb = boto3.resource('dynamodb')
      table = dynamodb.Table('new-steven')
      
     
   except Exception as e:
      print(str(e))
            
   return {
      'statusCode': 200,
      'body': json.dumps('It got to the end of the function')
    }
```

?> You will also have to create an IAM role with the necessary permissions, including a custom policy to allow your Lambda function to start and stop EC2 instances

5. One command we can use to grab all of our EC2 instances is describe_instances() with a Filter passed in.

```
instances = ec2.describe_instances(Filters=[{'Name': 'tag:<your_tag>', 'Values':['<your_vaue>']}])
```

?> There are a few ways to add your filters along with other inputs, the documentation does a good job of explaining more about this.
<https://docs.aws.amazon.com/cli/latest/reference/ec2/describe-instances.html>
